<!doctype html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-+0n0xVW2eSR5OomGNYDnhzAbDsOXxcvSN1TPprVMTNDbiYZCxYbOOl7+AMvyTG2x" crossorigin="anonymous">
    <title>ShowsHeist</title>
</head>

<body>
    <div class="container bg-info px-5 py-3 my-2">
        <p class="h1 text-center mb-5">Create New TG Post</p>
        <form id="detailsform">
            <div class="row">
                <div class="mb-3 col-md">
                    <label class="form-label">Type Of Video(s)*</label>
                    <select class="form-select" id="typeofvideo" required>
                        <option value="Webseries">Webseries</option>
                        <option value="Movie">Movie</option>
                    </select>
                </div>
                <div class="mb-3 col-md">
                    <label class="form-label" id="l_nom">Name Of Webseries*</label>
                    <input type="text" class="form-control" id="nom" autocomplete="off" required>
                </div>
                <div class="mb-3 col-md">
                    <label class="form-label">Code Name*</label>
                    <input type="text" class="form-control" id="cn" autocomplete="off" oninput="this.value = this.value.toUpperCase()" required>
                </div>

            </div>

            <div class="row">
                <div class="mb-3 col-md">
                    <label class="form-label">Language*</label>
                    <select class="form-select" id="lang" required>
                        <option value="Hindi">Hindi</option>
                        <option value="Bengali">Bengali</option>
                        <option value="English">English</option>
                    </select>
                </div>
                <div class="mb-3 col-md">
                    <label class="form-label">Season*</label>
                    <input type="number" class="form-control" id="nos" min="1" max="99" value="1" required>
                </div>
                <div class="mb-3 col-md">
                    <label class="form-label">Year Of Release*</label>
                    <input type="number" class="form-control" id="yor" min="1888" required>
                </div>

                <div class="mb-3 col-md">
                    <label class="form-label">No Of Episode**</label>
                    <input type="number" class="form-control" id="noe" min="1" max="20" value="1" required>
                </div>
            </div>
            <div class="row" id="div_ep">
                <div class="col">
                    <div class="input-group">
                        <span class="input-group-text" id="ep1">Episode 01</span>
                        <input type="text" class="form-control" id="url1" required>
                    </div>
                </div>
            </div>
            <div class="text-center">
                <a class="btn btn-primary mt-3" id="copy">Copy Code</a>
                <button type="submit" class="btn btn-primary mt-3" id="download">Download</button>
            </div>

        </form>


    </div>

    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-gtEjrD/SeCtmISkJkNUaaKMoLD0//ElJ19smozuHV6z3Iehds+3Ulb9Bn9Plx0x4" crossorigin="anonymous"></script> -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script>
        $(document).ready(function() {
            // var code;
            $('#typeofvideo').change(function() {
                if (this.value == "Webseries") {
                    $('#l_nom').text("Name Of Webseries")
                    $('#nos').prop('disabled', false);

                } else if (this.value == "Movie") {
                    $('#l_nom').text("Name Of Movie")
                    $('#nos').prop('disabled', true);
                }
            });

            $('input[type=number][id=noe]').change(function() {
                var noe = this.value;
                if (noe > 20) {
                    alert("No Of episode Should Not More Than 20");
                    return;
                }
                html = '<div class="col"><div class="input-group"><span class="input-group-text">Episode 01</span><input type="text" class="form-control" id="url1" required></div></div>'
                for (i = 2; i <= noe; i++) {
                    html += '<div class="col-4"><div class="input-group col-4"><span class="input-group-text">Episode ' + String("0" + i).slice(-2) + '</span><input type="text" class="form-control"  id="url' + i + '" required></div></div>';
                }
                $("#div_ep").html(html);
            });
            // $("#copy").click(function() {
            $('#detailsform').submit(function(e) {
                // e.preventDefault();
                var noe = $("#noe").val();
                var sub_noe = 3;
                var mainText = "";
                var videoDetails = "ðŸŽ¬ Shows Name : " + $("#nom").val() + " ";

                if ($("#typeofvideo").val() == "Webseries") {
                    videoDetails += " (Season " + String($("#nos").val()) + ")";
                    videoDetails += "\nðŸ“™ Language : " + $("#lang").val() + "\n" + "ðŸ’¿ Quality : FULL HD \n" + "ðŸ“¤ Uploader : @ShowsHeist\n\n\n";
                }
                var fileNamePrefix = getVideoCode();
                mainText += fileNamePrefix + "\n\n" + videoDetails;

                var linkDetails = "";
                if (noe == 1) { // if there are one link
                    if ($("#typeofvideo").val() == "Movie") {
                        linkDetails += "ðŸ”¥ WATCH NOW ðŸ”¥ - " + $("#url1").val();
                    } else {
                        linkDetails += "Episode :: 1 - " + $("#url1").val();
                    }
                } else {
                    for (i = 1; i <= noe; i = (i + 3)) {
                        if ((noe - i) < 3) {
                            sub_noe = (noe - i + 1)
                        }
                        for (j = 0; j < sub_noe; j++) {
                            if (j == (sub_noe - 1)) {
                                linkDetails += "Episode :: " + (i + j) + " - " + $(String("#url" + (i + j))).val();
                            }
                            linkDetails += "Episode :: " + (i + j) + " - " + $(String("#url" + (i + j))).val() + " | ";
                        }
                        linkDetails += "\n";
                    }
                }
                mainText += linkDetails;
                // var temp = $('<input>').val(mainText).appendTo('body').select();
                // document.execCommand('copy');
                // $temp.remove();

                alert("Text Copied");

                download(fileNamePrefix, mainText);
            });

            function download(filename, text) {
                var element = document.createElement('a');
                element.setAttribute('href', 'data:text/plain;charset=utf-8,' + encodeURIComponent(text));
                element.setAttribute('download', filename);

                element.style.display = 'none';
                document.body.appendChild(element);

                element.click();

                document.body.removeChild(element);
            }

            function copy(text) {
                var $input = $("<input>");
                $("body").append($input);
                $input.val(text).select();
                document.execCommand("copy");
                $input.remove();
            }

            $("#copy").click(function() {
                code = getVideoCode();
                if(code !== undefined ){
                    copy(code);                    
                    alert("Copied : \n" + code);
                }
                
            });

            function getVideoCode() {
                var code = "";
                if (!$('#nom').val() || !$('#cn').val() || !$('#yor').val()) {
                    alert("Complete * Marked Required Fields");
                    code = "";
                } else {
                    code = "SH" + String($('#lang').val()).charAt(0) + String($('#typeofvideo').val()).charAt(0) + $('#yor').val().slice(-2) + "_" + $('#cn').val();
                    if ($("#typeofvideo").val() == "Webseries") {
                        code += "_S" + String("0" + $('#nos').val()).slice(-2)
                    }
                    return code;
                }
            }
        });
    </script>
</body>

</html>
